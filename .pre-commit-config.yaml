---
# Apply to all files without committing:
#   pre-commit run --all-files
# Update this file:
#   pre-commit autoupdate

exclude: |
  (?x)^(
      .*\{\{.*\}\}.*|     # Exclude any files with cookiecutter variables
      docs/site/.*|       # Exclude mkdocs compiled files
      \.history/.*|       # Exclude history files
      .*cache.*/.*|       # Exclude cache directories
      .*venv.*/.*|        # Exclude virtual environment directories
      .*/versioneer\.py|
      .*/_version\.py|
      .*/.*\.svg
  )$

fail_fast: true

default_install_hook_types:
  - pre-commit
  - commit-msg

default_language_version:
  python: python3

ci:
    autofix_commit_msg: |
        [pre-commit.ci] auto fixes from pre-commit.com hooks

        for more information, see https://pre-commit.ci
    autofix_prs: true
    autoupdate_branch: ''
    autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
    autoupdate_schedule: weekly
    skip: []
    submodules: false

# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Python-specific checks
      - id: check-ast
        name: "ğŸ python Â· Validate syntax"
      - id: check-builtin-literals
        name: "ğŸ python Â· Use literal syntax"
      - id: check-docstring-first
        name: "ğŸ python Â· Validate docstring placement"
      - id: debug-statements
        name: "ğŸ python Â· Detect debug statements"
        language_version: python3

      # Git workflow protection
      - id: check-added-large-files
        name: "ğŸŒ³ git Â· Block large files"
        args: ['--maxkb=500']
      - id: check-merge-conflict
        name: "ğŸŒ³ git Â· Detect conflict markers"
      - id: forbid-new-submodules
        name: "ğŸŒ³ git Â· Prevent submodules"
      - id: no-commit-to-branch
        name: "ğŸŒ³ git Â· Protect main branches"
        args: ["--branch", "main", "--branch", "master"]
      - id: check-vcs-permalinks
        name: "ğŸŒ³ git Â· Validate VCS links"

      # Filesystem and naming validation
      - id: check-case-conflict
        name: "ğŸ“ filesystem Â· Check case sensitivity"
      - id: check-illegal-windows-names
        name: "ğŸ“ filesystem Â· Validate Windows names"
      - id: check-symlinks
        name: "ğŸ“ filesystem Â· Check symlink validity"
      - id: destroyed-symlinks
        name: "ğŸ“ filesystem Â· Detect broken symlinks"

      # File format validation
      - id: check-toml
        name: "ğŸ“‹ format Â· Validate TOML"
      - id: check-yaml
        name: "ğŸ“‹ format Â· Validate YAML"
        exclude: conda.recipe/meta.yaml

      # File content fixes
      - id: fix-byte-order-marker
        name: "âœ¨ fix Â· Remove BOM markers"
      - id: end-of-file-fixer
        name: "âœ¨ fix Â· Ensure final newline"
      - id: mixed-line-ending
        name: "âœ¨ fix Â· Normalize line endings"
      - id: trailing-whitespace
        name: "âœ¨ fix Â· Trim trailing whitespace"
        args: [--markdown-linebreak-ext=md]
      - id: requirements-txt-fixer
        name: "âœ¨ fix Â· Sort requirements"

      # Security checks
      - id: detect-private-key
        name: "ğŸ”’ security Â· Detect private keys"

  # Git commit quality
  - repo: https://github.com/jorisroovers/gitlint
    rev: v0.19.1
    hooks:
      - id: gitlint
        name: "ğŸŒ³ git Â· Validate commit format"

  - repo: https://github.com/commitizen-tools/commitizen
    rev: v4.11.1
    hooks:
      - id: commitizen
        name: "ğŸŒ³ git Â· Validate commit message"
        stages: [commit-msg]

  # Security scanning (grouped together)
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: "ğŸ”’ security Â· Detect committed secrets"

  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.30.0
    hooks:
      - id: gitleaks
        name: "ğŸ”’ security Â· Scan for hardcoded secrets"

  - repo: https://github.com/PyCQA/bandit
    rev: 1.9.2
    hooks:
      - id: bandit
        name: "ğŸ”’ security Â· Check Python vulnerabilities"
        args: ["-c", "pyproject.toml", "-r", "."]
        exclude: ^tests/
        additional_dependencies: [".[toml]"]

# TODO: Enable it for a single check
#  - repo: https://github.com/pypa/pip-audit
#    rev: v2.10.0
#    hooks:
#      - id: pip-audit
#        name: "ğŸ”’ security Â· Audit Python dependencies"
#        args: ['--desc', 'on']

  - repo: https://github.com/semgrep/pre-commit
    rev: 'v1.146.0'
    hooks:
      - id: semgrep
        name: "ğŸ”’ security Â· Static analysis (semgrep)"
        args: [ '--config=auto', '--error' ]


  # Spelling and typos
  - repo: https://github.com/crate-ci/typos
    rev: v1.40.0
    hooks:
      - id: typos
        name: "ğŸ“ spelling Â· Check typos"

#  - repo: https://github.com/codespell-project/codespell
#    rev: v2.4.1
#    hooks:
#      - id: codespell
#        name: "ğŸ“ spelling Â· Fix common misspellings"
#        args: [--write]
#        exclude: ^tests

  # CI/CD validation
  - repo: https://github.com/python-jsonschema/check-jsonschema
    rev: 0.36.0
    hooks:
      - id: check-dependabot
        name: "ğŸ”§ ci/cd Â· Validate Dependabot config"
      - id: check-github-workflows
        name: "ğŸ”§ ci/cd Â· Validate GitHub workflows"
        files: ^\.github/workflows/.*\.ya?ml$

  # Python code formatting (order matters: autoflake â†’ pyupgrade â†’ darker/ruff)
  - repo: https://github.com/PyCQA/autoflake
    rev: v2.3.1
    hooks:
      - id: autoflake
        name: "ğŸ format Â· Remove unused imports"
        args:
          - --in-place
          - --remove-all-unused-imports
          - --remove-unused-variable
          - --ignore-init-module-imports

  - repo: https://github.com/asottile/pyupgrade
    rev: v3.21.2
    hooks:
      - id: pyupgrade
        name: "ğŸ format Â· Modernize syntax"
        args: [--py310-plus, --keep-runtime-typing]

  - repo: https://github.com/akaihola/darker
    rev: v3.0.0
    hooks:
      - id: darker
        name: "ğŸ format Â· Format changed lines"
        additional_dependencies: [black]

  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.14.10
    hooks:
      - id: ruff-check
        name: "ğŸ lint Â· Check with Ruff"
        args: [--fix, --preview, --exit-non-zero-on-fix]
      - id: ruff-format
        name: "ğŸ format Â· Format with Ruff"

  # Python linting (comprehensive checks)
  - repo: https://github.com/pycqa/flake8
    rev: 7.3.0
    hooks:
      - id: flake8
        name: "ğŸ lint Â· Check style (Flake8)"
        args: ["--ignore=E501,C901", --max-complexity=13]  # Sets McCabe complexity limit
        additional_dependencies:
          - radon
          - flake8-docstrings
          - Flake8-pyproject
          - flake8-bugbear
          - flake8-comprehensions
          - flake8-tidy-imports
          - pycodestyle
        exclude: ^tests

  - repo: https://github.com/PyCQA/pylint
    rev: v4.0.4
    hooks:
      - id: pylint
        name: "ğŸ lint Â· Check code quality"
        args:
          - --exit-zero

  - repo: https://github.com/dosisod/refurb
    rev: v2.2.0
    hooks:
      - id: refurb
        name: "ğŸ performance Â· Suggest modernizations"
        # TODO: Fix FURB147.
        args: ["--enable-all", "--ignore", "FURB147"]

  # Python documentation
  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        name: "ğŸ docs Â· Validate docstrings"
        args: [--select=D200,D213,D400,D415]
        additional_dependencies: [tomli]

  - repo: https://github.com/econchick/interrogate
    rev: 1.7.0
    hooks:
      - id: interrogate
        name: "ğŸ“ docs Â· Check docstring coverage"
        args: [ --verbose, --fail-under=53, --ignore-init-method ]

  # Python type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1
    hooks:
      - id: mypy
        name: "ğŸ types Â· Check with mypy"
        args: [--config-file=./pyproject.toml]
        additional_dependencies:
          - types-requests
          - pytest-order
        exclude: ^mailgun/examples/

  - repo: https://github.com/RobertCraigie/pyright-python
    rev: v1.1.407
    hooks:
      - id: pyright
        name: "ğŸ types Â· Check with pyright"

  # Python project configuration
  - repo: https://github.com/abravalheri/validate-pyproject
    rev: v0.24.1
    hooks:
      - id: validate-pyproject
        name: "ğŸ config Â· Validate pyproject.toml"

  - repo: https://github.com/tox-dev/pyproject-fmt
    rev: v2.8.0
    hooks:
      - id: pyproject-fmt
        name: "ğŸ config Â· Format pyproject.toml"

#  - repo: https://github.com/mgedmin/check-manifest
#    rev: '0.50'
#    hooks:
#      - id: check-manifest
#        name: "ğŸ ğŸ“¦ packaging Â· Verify MANIFEST"
#        args: [--no-build-isolation, --ignore-bad-ideas=MANIFEST.in]
#        additional_dependencies: [setuptools, wheel, setuptools-scm]

  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.10.0
    hooks:
      - id: python-check-blanket-noqa
        name: "ğŸ lint Â· Disallow blanket noqa"
      - id: python-use-type-annotations
        name: "ğŸ types Â· Enforce type annotations"
      - id: python-check-blanket-type-ignore
        name: "ğŸ types Â· Disallow blanket type:ignore"
      - id: python-no-log-warn
        name: "ğŸ lint Â· Use logging.warning not warn"
      - id: text-unicode-replacement-char
        name: "ğŸ“‹ format Â· Detect unicode replacement char"
      - id: python-no-eval
        name: "ğŸ”’ security Â· Prevent eval() usage"

  # Markdown formatting
  - repo: https://github.com/executablebooks/mdformat
    rev: 1.0.0
    hooks:
      - id: mdformat
        name: "ğŸ“ markdown Â· Format files"
        additional_dependencies:
          - mdformat-gfm
          - mdformat-black
          - mdformat-ruff
# TODO: Enable it for a single check
#  - repo: https://github.com/tcort/markdown-link-check
#    rev: v3.14.2
#    hooks:
#      - id: markdown-link-check
#        name: "ğŸ“ docs Â· Check markdown links"

  # Makefile linting
  - repo: https://github.com/checkmake/checkmake
    rev: 0.2.2
    hooks:
      - id: checkmake
        name: "ğŸ”§ build Â· Lint Makefile"
